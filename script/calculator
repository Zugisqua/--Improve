#!/bin/bash


#=====-declare=====#
for i in $(seq 0 5)
do
    At[i]=$(grep -Po "(?<=day $i:).+" $HOME/.logitime/.ltconfig)
done
num=$(grep -Po '(?<=num:).+' $HOME/.logitime/.ltconfig)
log=$HOME/.logitime/log
tmp_=$HOME/.logitime/.tmp_
#=====read=====#

cnt=0;j=0;i=1;Ju=1
while read a b c d
do
    if [[ $a != [0-5] ]];then	
	cnt=$((cnt + 1))
	tmp[$cnt]=$a
	Ju=1
	if [[ $cnt != 1 ]];then	    
	    for k in $(seq 1 $((cnt-1)))
	    do
		if [[ ${tmp[$k]} == $a ]];then
		    Ju=$((Ju*0))
		else
		    Ju=$((Ju*1))
		fi
	    done
	fi
	if [[ $Ju = 1 ]] ;then
	    Sub[$i]=$a
	    i=$((i+1))
	fi
	let S_$a[$j-1]=$((S_$a[j-1]+c-b))
	let Tols[$j-1]=$((Tols[j-1]+c-b))
	let C_$a[$j-1]=$((C_$a[j-1]+1))
#-------output-----#
	printf "$((6+b/6)):$((b%6))0-$((6+c/6)):$((c%6))0\t$(((c-b)/6)):$(((c-b)%6))0\t[$((j-1))]$a\n"
	if [[ $(echo $1|grep -|grep -o m) != "" ]];then
	    echo \ \ Notes: $d
	fi	
    else
	echo =========
	printf "\tDay:$a\n"
	j=$(($j + 1))
    fi	  		
done < $log

#------comment-------#
echo \ 
echo ======================
for k in ${Tols[@]};do TolS=$((TolS+k));done
for k in $(seq 0 $((j-1)))
do
    AT=$((AT+At[$k]))
    printf "[$k] Total Duration: $((Tols[k]/6)):$((Tols[k]%6))0/$((At[k]/6)):$((At[k]%6))0\tOccupy: $((Tols[k]*100/At[k]))%%\n"
done
printf "    Total ALL: $((TolS/6)):$((TolS%6))0/$((AT/6)):$((AT%6))0\tmean: $((TolS*100/AT))%%\n"

if [[  $(echo $1|grep -|grep -Po d) != "" ]];then
    rm $tmp_$num
    echo ----------------------
    for k in ${Sub[@]}
    do
	[ "$(echo $1|grep -|grep -Po l)" = "" ] && echo $k:
	for l in $(seq 0 $((j-1)))
	do
	    let As_$k=$((As_$k+S_$k[l]))
	    let Ac_$k=$((Ac_$k+C_$k[l]))
	    [ "$(echo $1|grep -|grep -Po l)" = "" ] && printf "  [$l] $((S_$k[l]/6)):$((S_$k[l]%6))0\t"
	done
	t="$((As_$k/6)):$((As_$k%6))0"
	o="$((As_$k*100/AT)).$(((As_$k*1000/AT)%10))%%"
	a="$(((As_$k/Ac_$k)/6)):$(((As_$k/Ac_$k)%6))0"	 
	ta=$((As_$k))
	echo "$k $ta" >> $tmp_$num
	[ "$(echo $1|grep -|grep -Po l)" = "" ] && printf "\n  Total: $t\tOccupy: $o\n  Aver-duration: $a\n"
    done
    for k in ${Sub[@]}
    do	
	if [ "$(echo $1|grep -|grep -Po l)" != "" ];then    
	    grep $k $tmp_$num|grep -Po "(?<= ).+" >> $tmp_
	    sum=0
	    while read x
	    do
		sum=$((x+sum))
	    done < $tmp_
	    rm $tmp_
	    while read x y
	    do		
		[ "$x" = "$k"  ] &&  echo "$sum $x $y" >> "$tmp_"_
	    done < $tmp_$num
	fi
    done
    if [  "$(echo $1|grep -|grep -Po l)" != ""  ];then
	mv "$tmp_"_ $tmp_$num
	echo "__$(date)__" >> $tmp_$num
	echo \ Calculate for TO-DOs done.
    fi    
fi



    



